{% extends 'base.html' %}

{% block head %}
<link href="{{ url_for('static', filename='styles/use-case.css') }}" rel="stylesheet" />
<script src="{{ url_for('static', filename='highlight/highlight.min.js') }}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script>

<!-- Load mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-MML-AM_CHTML-full,Safe"></script>

<!-- MathJax configuration -->
<script type="text/x-mathjax-config">
init_mathjax = function() {
    if (window.MathJax) {
    // MathJax loaded
        MathJax.Hub.Config({
            TeX: {
                equationNumbers: {
                autoNumber: "AMS",
                useLabelIds: true
                }
            },
            tex2jax: {
                inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
                processEscapes: true,
                processEnvironments: true
            },
            displayAlign: 'center',
            CommonHTML: {
                linebreaks: { 
                automatic: true 
                }
            },
            "HTML-CSS": {
                linebreaks: { 
                automatic: true 
                }
            }
        });
    
        MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
    }
}
init_mathjax();
</script>
<!-- End of mathjax configuration -->
{% endblock %}


<!--body starts here!!!-->
{% block content %}
<div class="jp-Notebook container" data-jp-theme-light="true" data-jp-theme-name="JupyterLab Light">

<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
  <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
      <div class="jp-InputArea jp-Cell-inputArea">
        <div class="jp-InputPrompt jp-InputArea-prompt"></div>
        <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput "data-mime-type="text/markdown">
          <div class="usecase-title">New Business Location Use Case</div>
          <div class="usecase-authors"><b>Authored by: </b> Steven Tuften</div>
        </div>
      </div>
  </div>
</div>

<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
  <div class="jp-Cell-inputWrapper">
      <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
      </div>
      <div class="jp-InputArea jp-Cell-inputArea">
          <div class="jp-InputPrompt jp-InputArea-prompt">
          </div>
          <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput "
              data-mime-type="text/markdown">
              <div class="usecase-duration"><b>Duration:</b> 90 mins</div>
              <div class="usecase-level-skill">
                  <div class="usecase-level"><b>Level: </b>Intermediate</div>
                  <div class="usecase-skill"><b>Pre-requisite Skills: </b>Python</div>
              </div>
          </div>
      </div>
  </div>
</div>

<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
  <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
      <div class="jp-InputArea jp-Cell-inputArea">
          <div class="jp-InputPrompt jp-InputArea-prompt"></div>
          <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
            <div class="usecase-section-header">Scenario</div>
          </div>
      </div>
  </div>
</div>

<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
  <div class="jp-Cell-inputWrapper">
      <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
      <div class="jp-InputArea jp-Cell-inputArea">
          <div class="jp-InputPrompt jp-InputArea-prompt"></div>
          <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput "data-mime-type="text/markdown">
              <p><strong>As a Cafe, Restaurant or Bar, I am looking for commercial space in the City of Melbourne where I can open a new venue or extend my existing venue.
                <a class="anchor-link" href="#As-a-Cafe,-Restaurant-or-Bar,-I-am-looking-for-commercial-space-in-the-City-of-Melbourne-where-I-can-open-a-new-venue-or-extend-my-existing-venue.">&#182;</a>
                I would like to know where similar businesses are located and the density of residents and office workers in comparison.
                <a class="anchor-link" href="#I-would-like-to-know-where-similar-businesses-are-located-and-the-density-of-residents-and-office-workers-in-comparison.">&#182;</a>
                I want to know the number of seats I should provide based on seating capacity at other similar establishments in the same area.
                 </strong>
              </p>
          </div>
      </div>
  </div>
</div>

<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
  <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-InputArea jp-Cell-inputArea">
      <div class="jp-InputPrompt jp-InputArea-prompt"></div>
      <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
        <div class="usecase-section-header">What this use case will teach you</div>
      </div>
    </div>
  </div>
</div>

<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
  <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-InputArea jp-Cell-inputArea">
      <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
        <p>At the end of this use case you will:</p>
        <ul>
          <li>understand what CLUE data is and how to access it</li>
          <li>have explored a dataset derived from the CLUE survey</li>
          <li>learnt how to visualise CLUE data using different mapping visualisation techniques</li>
        </ul>
      </div>
    </div>
    <div class="jp-InputPrompt jp-InputArea-prompt"></div> 
  </div>
</div>


<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
  <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-InputArea jp-Cell-inputArea">
      <div class="jp-InputPrompt jp-InputArea-prompt"></div>
      <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
        <div class="usecase-section-header">A brief introduction to CLUE data</div>
      </div>
    </div>
  </div>
</div>

<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
  <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-InputArea jp-Cell-inputArea">
      <div class="jp-InputPrompt jp-InputArea-prompt"></div>
      <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
        <p>The City of Melbourne conducts a comprehensive bi-annual survey of its residents and businesses called the "Census of Land Use and Employment (CLUE)". CLUE captures key information on land use, employment, and economic activity across the City of Melbourne.</p>
        <p>CLUE datasets are a valuable tool for businesses looking to invest in the City of Melbourne and for researchers wanting to understand those factors that influence and shape the social and economic dynamics of Australia's second largest metropolis and one of the world's most liveable cities.</p>
        <p>CLUE data assists the City of Melbourne's business planning, policy development and strategic decision making. Investors, consultants, students, urban researchers, property analysts, businesses and developers can take advantage of CLUE to understand customers, the marketplace and the changing form and nature of the city.</p>
        <p>Source: <strong><a href="https://data.melbourne.vic.gov.au/stories/s/CLUE/rt3z-vy3t?src=hdr"target="_blank">CLUE</a></strong></p>
        <p>This use case utilises various CLUE datasets to illustrate their value to Data Scientists, Researchers and Software Developers.</p>
        <h3 id="CLUE-Geospatial-Data">CLUE Geospatial Data<a class="anchor-link" href="#CLUE-Geospatial-Data">&#182;</a></h3><p>CLUE Data is often coded to a specific location (Latitude and Longitude) and/or to a City precinct, referred to as the "CLUE small area". Datasets may also include the individual city block within a precinct referred to by its CLUE Block ID.</p>
        <p>The geospatial coordinates describing these areas as polygons can be downloaded in GeoJSON format and used to show shaded areas on a map, known as a choropleth map. This can be a useful technique for illustrating broad trends or statistics for a city area rather than a specific location.</p>
        <p>A map visualisation of CLUE Blocks and small areas can be found at the following links:</p>
        <ul>
        <li><strong><a href="https://data.melbourne.vic.gov.au/Business/Small-Areas-for-Census-of-Land-Use-and-Employment-/gei8-3w86"target="_blank">CLUE small areas</a></strong></li>
        <li><strong><a href="https://data.melbourne.vic.gov.au/Business/Blocks-for-Census-of-Land-Use-and-Employment-CLUE-/aia8-ryiq"target="_blank">CLUE Blocks</a></strong> </li>
        </ul>
      </div>
    </div>
  </div>
</div>

<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
  <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-InputArea jp-Cell-inputArea">
      <div class="jp-InputPrompt jp-InputArea-prompt"></div>
      <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
        <div class="usecase-section-header">Which CLUE data should I use?</div>
      </div>
    </div>
  </div>
</div>

<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
  <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-InputArea jp-Cell-inputArea">
      <div class="jp-InputPrompt jp-InputArea-prompt"></div>
      <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
        <p>To begin we shall first import the necessary libraries to support our exploratory data analysis and visualisation of the CLUE data.</p>
        <p>The following are core packages required for this exercise:</p>
        <ul>
        <li><p>The sodapy package is required specifically for accessing open data from SOCRATA compliant open data web sites.</p>
        </li>
        <li><p>The plotly.express package lets use build interact maps using map box services.</p>
        </li>
        </ul>
      </div>
    </div>
  </div>
</div>



<div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
  <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-InputArea jp-Cell-inputArea">
      <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[1]:</div>
      <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
        <div class="snippet-language">
          <span class="icon"><i class="fab fa-python"></i></span>
          <span class=>Python</span>
        </div>
        <figure class="highlight">
          <pre>
            <code class="language-python" data-lang="python"><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sodapy</span> <span class="kn">import</span> <span class="n">Socrata</span>
<span class="kn">import</span> <span class="nn">plotly.graph_objs</span> <span class="k">as</span> <span class="nn">go</span>
<span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
            </code>   
          </pre>
        </figure>
      </div>
    </div>
  </div>
</div>

<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
  <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-InputArea jp-Cell-inputArea">
      <div class="jp-InputPrompt jp-InputArea-prompt"></div>
      <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
        <p>To connect to the Melbourne Open Data Portal we must establish a connection using the sodapy library by specifying a domain, being the website domain where the data is hosted, and an application access token which can be requested from the City of Melbourne Open Data portal by registering <strong><a href="https://data.melbourne.vic.gov.au/signup">here</a></strong></p>
        <p>For this exercise we will access the domain without an application token</p>
      </div>
    </div>
  </div>
</div>


<div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
  <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-InputArea jp-Cell-inputArea">
      <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[2]:</div>
      <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
        <div class="snippet-language">
          <span class="icon"><i class="fab fa-python"></i></span>
          <span class=>Python</span>
        </div>
        <figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="n">apptoken</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SODAPY_APPTOKEN&quot;</span><span class="p">)</span> <span class="c1"># Anonymous app token</span>
<span class="n">domain</span> <span class="o">=</span> <span class="s2">&quot;data.melbourne.vic.gov.au&quot;</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">Socrata</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">apptoken</span><span class="p">)</span> <span class="c1"># Open Dataset connection</span>
</code></pre>
        </figure>
      </div>
    </div>
  </div>
  <div class="jp-Cell-outputWrapper">
    <div class="jp-OutputArea jp-Cell-outputArea">
      <div class="jp-OutputArea-child">  
        <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
        <div class="jp-RenderedText jp-OutputArea-output" data-mime-type="application/vnd.jupyter.stderr">
          <pre>WARNING:root:Requests made without an app_token will be subject to strict throttling limits.</pre>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
  <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-InputArea jp-Cell-inputArea">
      <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
        <p>Next, we will look at one of the CLUE datasets to better understand its structure and how we can use it.</p>
        <p>Our data requirements from this use case include the following:</p>
        <ul>
          <li>Number of Residential Dwellings per CLUE Block</li>
          <li>Number of Employees per CLUE Block</li>
          <li>Number of Seats (Indoor and Outdoor) per Venue and CLUE Block</li>
        </ul>
        <p>For this exercise, we shall start by examining the Residential Dwelling dataset.
    Each dataset in the Melbourne Open Data Portal has a unique identifier which can be used to retrieve the dataset using the sodapy library.</p>
        <p>The Residential Dwelling dataset unique identifier is <strong>rm92-h5tq</strong>.
    We will pass this identifier into the sodapy command below to retrieve this data.</p>
        <p>This dataset is placed in a Pandas dataframe and we will inspect the first three rows.</p>
      </div>
    </div>
    <div class="jp-InputPrompt jp-InputArea-prompt"></div>
  </div>
</div>


<div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
  <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-InputArea jp-Cell-inputArea">
      <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[3]:</div>
      <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
        <div class="snippet-language">
          <span class="icon"><i class="fab fa-python"></i></span>
          <span class=>Python</span>
        </div>
        <figure class="highlight">
          <pre>
            <code class="language-python" data-lang="python"><span></span><span class="c1"># Retrieve the &quot;CLUE Residential Dwellings 2020&quot; dataset</span>
<span class="n">data_rm92_h5tq</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">get_all</span><span class="p">(</span><span class="s1">&#39;rm92-h5tq&#39;</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The shape of dataset is </span><span class="si">{</span><span class="n">data_rm92_h5tq</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Below are the first few rows of this dataset:&#39;</span><span class="p">)</span>

<span class="c1"># Transpose the DataFrame for easier visual comparison. </span>
<span class="n">data_rm92_h5tq</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            </code>
          </pre>
        </figure>
      </div>
    </div>
  </div>

  <div class="jp-Cell-outputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-OutputArea jp-Cell-outputArea">
      <div class="jp-OutputArea-child">
        <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
        <div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain">
        <pre>The shape of dataset is (10402, 10).
        Below are the first few rows of this dataset:
        </pre>
        </div>
      </div>

      <div class="jp-OutputArea-child">
        <div class="jp-OutputPrompt jp-OutputArea-prompt">Out[3]:</div>
        <div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/html">
          <div>
            <style scoped>
              .dataframe tbody tr th:only-of-type {
                vertical-align: middle;
              }
              .dataframe tbody tr th {
                vertical-align: top;
              }
              .dataframe thead th {
                text-align: right;
              }
            </style>
            <table border="1" class="dataframe">
              <thead>
                <tr style="text-align: right;">
                  <th></th>
                  <th>0</th>
                  <th>1</th>
                  <th>2</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <th>census_year</th>
                  <td>2020</td>
                  <td>2020</td>
                  <td>2020</td>
                </tr>
                <tr>
                  <th>block_id</th>
                  <td>1</td>
                  <td>1</td>
                  <td>11</td>
                </tr>
                <tr>
                  <th>pbs_property_id</th>
                  <td>611394</td>
                  <td>611395</td>
                  <td>103957</td>
                </tr>
                <tr>
                  <th>bps_base_id</th>
                  <td>611394</td>
                  <td>611395</td>
                  <td>103957</td>
                </tr>
                <tr>
                  <th>street_name</th>
                  <td>545-557 Flinders Street MELBOURNE VIC 3000</td>
                  <td>561-581 Flinders Street MELBOURNE VIC 3000</td>
                  <td>517-537 Flinders Lane MELBOURNE VIC 3000</td>
                </tr>
                <tr>
                  <th>clue_small_area</th>
                  <td>Melbourne (CBD)</td>
                  <td>Melbourne (CBD)</td>
                  <td>Melbourne (CBD)</td>
                </tr>
                <tr>
                  <th>dwelling_type</th>
                  <td>Residential Apartments</td>
                  <td>Residential Apartments</td>
                  <td>Residential Apartments</td>
                </tr>
                <tr>
                  <th>dwelling_number</th>
                  <td>196</td>
                  <td>189</td>
                  <td>26</td>
                </tr>
                <tr>
                  <th>x_coordinate</th>
                  <td>144.9565145</td>
                  <td>144.9559094</td>
                  <td>144.9566569</td>
                </tr>
                <tr>
                  <th>y_coordinate</th>
                  <td>-37.82097941</td>
                  <td>-37.82108687</td>
                  <td>-37.81987147</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
  <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-InputArea jp-Cell-inputArea">
      <div class="jp-InputPrompt jp-InputArea-prompt"></div>
      <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
        <p>We can see that there are 10,402 records and 10 fields describing each record.</p>
        <p>Each record show us the number of dwellings for each individual property and the type of dwelling e.g. House/Townhouse, Residential Apartments, etc.</p>
        <p>The location of each property is given using:</p>
        <ul>
        <li>Latitude and Longitude</li>
        <li>CLUE Small Area and Block ID</li>
        <li>Property Id</li>
        </ul>
        <p>The Census year that the data was collected is also shown.</p>
        <p>For our analysis of this dataset and others we will be restricting our analysis to the 2020 CLUE Census and summarising the data to CLUE Block level.</p>
      </div>
    </div>
  </div>
</div>


<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
  <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-InputArea jp-Cell-inputArea">
      <div class="jp-InputPrompt jp-InputArea-prompt"></div>
      <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
        <div class="usecase-section-header">Summarising Residential Dwelling data</div>
      </div>
    </div>
  </div>
</div>

<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
  <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-InputArea jp-Cell-inputArea">
      <div class="jp-InputPrompt jp-InputArea-prompt"></div>
      <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
        <p>We want to plot the density of both residential dwellings and employment at city block level rather than a specific property or address. We can use a <strong><a href="https://en.wikipedia.org/wiki/Choropleth_map"target="_blank">choropleth map</a></strong> to do this.</p>
        <p>Let's start by summarising the data at CLUE small area and Block level.</p>
        <p><em>Note: We include CLUE Small Area as one of our group by fields so we can display the CLUE Small area name in the popup window when you hover over the area on the map.</em></p>
        <p>We want to summarise the data by summing the number of dwellings across all rows in the same CLUE Block.</p>
        <p>The following cell creates a dataframe containing this summary of residential dwellings.</p>
      </div>
    </div>
  </div>
</div>


<div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
 <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-InputArea jp-Cell-inputArea">
      <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[4]:</div>
      <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
        <div class="snippet-language">
          <span class="icon"><i class="fab fa-python"></i></span>
          <span class=>Python</span>
        </div>
        <figure class="highlight">
          <pre>
            <code class="language-python" data-lang="python"><span></span><span class="c1"># Cast datatypes to correct type so we can summarise</span>
<span class="n">data_rm92_h5tq</span><span class="p">[[</span><span class="s1">&#39;census_year&#39;</span><span class="p">,</span> <span class="s1">&#39;dwelling_number&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">data_rm92_h5tq</span><span class="p">[[</span><span class="s1">&#39;census_year&#39;</span><span class="p">,</span> <span class="s1">&#39;dwelling_number&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">data_rm92_h5tq</span><span class="p">[[</span><span class="s1">&#39;x_coordinate&#39;</span><span class="p">,</span> <span class="s1">&#39;y_coordinate&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">data_rm92_h5tq</span><span class="p">[[</span><span class="s1">&#39;x_coordinate&#39;</span><span class="p">,</span> <span class="s1">&#39;y_coordinate&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">data_rm92_h5tq</span> <span class="o">=</span> <span class="n">data_rm92_h5tq</span><span class="o">.</span><span class="n">convert_dtypes</span><span class="p">()</span> <span class="c1"># convert remaining to string</span>
<span class="n">data_rm92_h5tq</span><span class="o">.</span><span class="n">dtypes</span>

<span class="c1"># create the aggregate dataset</span>
<span class="n">groupbyfields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;block_id&#39;</span><span class="p">,</span><span class="s1">&#39;clue_small_area&#39;</span><span class="p">]</span>
<span class="n">aggregatebyfields</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dwelling_number&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;sum&quot;</span><span class="p">]}</span>

<span class="n">dwellingsByBlock</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data_rm92_h5tq</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">groupbyfields</span><span class="p">,</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">aggregatebyfields</span><span class="p">))</span>

<span class="c1"># Dataframse Group by creates two levels of headings</span>
<span class="c1"># so we flatten the headings to make it easier to extract data for plotting</span>
<span class="n">dwellingsByBlock</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">dwellingsByBlock</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">)</span> <span class="c1"># flatten column header</span>
<span class="n">dwellingsByBlock</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;clue_small_area&#39;</span><span class="p">:</span> <span class="s1">&#39;clue_area&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1">#rename to match GeoJSON extract</span>
<span class="n">dwellingsByBlock</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;dwelling_numbersum&#39;</span><span class="p">:</span> <span class="s1">&#39;dwelling_count&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">dwellingsByBlock</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
          </code>
        </pre>
      </figure>
    </div>
  </div>
 </div>

  <div class="jp-Cell-outputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-OutputArea jp-Cell-outputArea">
      <div class="jp-OutputArea-child">
        <div class="jp-OutputPrompt jp-OutputArea-prompt">Out[4]:</div>
        <div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/html">
          <div>
            <style scoped>
              .dataframe tbody tr th:only-of-type {
              vertical-align: middle;
              }
              .dataframe tbody tr th {
                  vertical-align: top;
              }
              .dataframe thead th {
                  text-align: right;
              }
            </style>
            <table border="1" class="dataframe">
              <thead>
                <tr style="text-align: right;">
                  <th></th>
                  <th>block_id</th>
                  <th>clue_area</th>
                  <th>dwelling_count</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <th>0</th>
                  <td>1</td>
                  <td>Melbourne (CBD)</td>
                  <td>385</td>
                </tr>
                <tr>
                  <th>1</th>
                  <td>101</td>
                  <td>West Melbourne (Residential)</td>
                  <td>863</td>
                </tr>
                <tr>
                  <th>2</th>
                  <td>103</td>
                  <td>Melbourne (CBD)</td>
                  <td>638</td>
                </tr>
                <tr>
                  <th>3</th>
                  <td>104</td>
                  <td>Melbourne (CBD)</td>
                  <td>1093</td>
                </tr>
                <tr>
                  <th>4</th>
                  <td>105</td>
                  <td>Melbourne (CBD)</td>
                  <td>1729</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
  <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-InputArea jp-Cell-inputArea">
      <div class="jp-InputPrompt jp-InputArea-prompt"></div>
      <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
        <div class="usecase-section-header">Visualising Residential Dwelling on a Choropleth Map</div>
      </div>
    </div>
  </div>
</div>


<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
  <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-InputArea jp-Cell-inputArea">
      <div class="jp-InputPrompt jp-InputArea-prompt"></div>
      <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
        <p>We use the <strong><a href="https://plotly.com/python/"target="_blank">Plotly Python Open Source Graphing Library</a></strong> to generate maps from <strong><a href="https://www.mapbox.com/"target="_blank">mapbox</a></strong>.</p>
        <p>Creating a choropleth map requires us to know the geometry(shape) of each CLUE Block area as a collection of latitude and longitude points defining a polygon. This data can be downloaded from the Melbourne Open Data Portal in <strong><a href="https://en.wikipedia.org/wiki/GeoJSON"target="_blank">GeoJSON</a></strong> format.</p>
        <p>We also need to supply the data to be used to highlight the CLUE Blocks and that data must include the same unique identifier for each Block contained in the GeoJSON data set.</p>
        <p>Below we extract the Melbourne CLUE Block polygons into a JSON datatype.</p>
        <p><strong>The final line in the cell displays the unique key for each polygon which must also exist in the Residential Dwelling dataset.</strong></p>
      </div>
    </div>
  </div>
</div>


<div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
  <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-InputArea jp-Cell-inputArea">
      <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[5]:</div>
      <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
        <div class="snippet-language">
          <span class="icon"><i class="fab fa-python"></i></span>
          <span class=>Python</span>
        </div>
        <figure class="highlight">
          <pre>
            <code class="language-python" data-lang="python"><span></span><span class="kn">from</span> <span class="nn">urllib.request</span> <span class="kn">import</span> <span class="n">urlopen</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="n">geoJSON_Id</span> <span class="o">=</span> <span class="s1">&#39;aia8-ryiq&#39;</span> <span class="c1"># Melbourne CLUE Block polygons in GeoJSON format</span>

<span class="n">GeoJSONURL</span> <span class="o">=</span> <span class="s1">&#39;https://&#39;</span><span class="o">+</span><span class="n">domain</span><span class="o">+</span><span class="s1">&#39;/api/geospatial/&#39;</span><span class="o">+</span><span class="n">geoJSON_Id</span><span class="o">+</span><span class="s1">&#39;?method=export&amp;format=GeoJSON&#39;</span>
<span class="k">with</span> <span class="n">urlopen</span><span class="p">(</span><span class="n">GeoJSONURL</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
    <span class="n">block</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
    
<span class="n">block</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;properties&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            </code>
          </pre>
        </figure>
      </div>
    </div>
  </div>

  <div class="jp-Cell-outputWrapper">


    <div class="jp-OutputArea jp-Cell-outputArea">

      <div class="jp-OutputArea-child">

        <div class="jp-OutputPrompt jp-OutputArea-prompt">Out[5]:</div>
        <div class="jp-RenderedText jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/plain">
          <pre>dict_keys([&#39;block_id&#39;, &#39;clue_area&#39;])</pre>
        </div>
      </div>
    </div>
  </div>
</div>


<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
  <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-InputArea jp-Cell-inputArea">
      <div class="jp-InputPrompt jp-InputArea-prompt"></div>
      <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
        <p>Now using just one function call called 'choropleth_mapbox' we can diaplay an interactive map using the <strong>block</strong> GeoJSON data to define the regions and the <strong>dwellingsByBlock</strong> dataframe to define the summarised data by block.</p>
      </div>
    </div>
  </div>
</div>



<div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
  <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-InputArea jp-Cell-inputArea">
    <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[6]:</div>
    <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
      <div class="snippet-language">
        <span class="icon"><i class="fab fa-python"></i></span>
        <span class=>Python</span>
      </div>
      <figure class="highlight">
        <pre>
          <code class="language-python" data-lang="python"><span></span><span class="c1"># Display the choropleth map</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">choropleth_mapbox</span><span class="p">(</span><span class="n">dwellingsByBlock</span><span class="p">,</span> <span class="c1"># pass in the summarised dwellings per block</span>
                           <span class="n">geojson</span><span class="o">=</span><span class="n">block</span><span class="p">,</span> <span class="c1"># pass in the GeoJSON data defining the CLUE Block polygons</span>
                           <span class="n">locations</span><span class="o">=</span><span class="s1">&#39;block_id&#39;</span><span class="p">,</span> <span class="c1"># define the unique identifier for the Blocks from the dataframe</span>
                           <span class="n">color</span><span class="o">=</span><span class="s1">&#39;dwelling_count&#39;</span><span class="p">,</span> <span class="c1"># change the colour of the block region according to the dwelling count</span>
                           <span class="n">color_continuous_scale</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;#FFFF88&quot;</span><span class="p">,</span> <span class="s2">&quot;yellow&quot;</span><span class="p">,</span> <span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="s2">&quot;orange&quot;</span><span class="p">,</span>
                                                   <span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="s2">&quot;darkorange&quot;</span><span class="p">,</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;darkred&quot;</span><span class="p">],</span> <span class="c1"># define custom colour scale</span>
                           <span class="n">range_color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dwellingsByBlock</span><span class="p">[</span><span class="s1">&#39;dwelling_count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()),</span> <span class="c1"># set the numeric range for the colour scale</span>
                           <span class="n">featureidkey</span><span class="o">=</span><span class="s2">&quot;properties.block_id&quot;</span><span class="p">,</span> <span class="c1"># define the Unique polygon identifier from the GeoJSON data</span>
                           <span class="n">mapbox_style</span><span class="o">=</span><span class="s2">&quot;stamen-toner&quot;</span><span class="p">,</span> <span class="c1"># set the visual style of the map</span>
                           <span class="n">zoom</span><span class="o">=</span><span class="mf">12.15</span><span class="p">,</span> <span class="c1"># set the zoom level</span>
                           <span class="n">center</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;lat&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">37.813</span><span class="p">,</span> <span class="s2">&quot;lon&quot;</span><span class="p">:</span> <span class="mf">144.945</span><span class="p">},</span> <span class="c1"># set the map centre coordinates</span>
                           <span class="n">opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="c1"># opacity of the choropleth polygons</span>
                           <span class="n">hover_name</span><span class="o">=</span><span class="s1">&#39;clue_area&#39;</span><span class="p">,</span> <span class="c1"># the title of the hover pop up box</span>
                           <span class="n">hover_data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;block_id&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;dwelling_count&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">},</span> <span class="c1"># defines which dataframe fields to display</span>
                                                                               <span class="c1"># in the hover popup box</span>
                           <span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;dwelling_count&#39;</span><span class="p">:</span><span class="s1">&#39;Number of Dwellings&#39;</span><span class="p">,</span><span class="s1">&#39;block_id&#39;</span><span class="p">:</span><span class="s1">&#39;CLUE Block Id&#39;</span><span class="p">},</span> <span class="c1"># defines labels for</span>
                                                                               <span class="c1"># the hover popup box</span>
                           <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Residential Dwellings by CLUE Block Id for 2020&#39;</span><span class="p">,</span> <span class="c1"># Title for plot</span>
                           <span class="n">width</span><span class="o">=</span><span class="mi">950</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">800</span> <span class="c1"># dimensions of plot in pixels</span>
                          <span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            </code>
          </pre>
        </figure>
      </div>
    </div>
  </div>

  <div class="jp-Cell-outputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-OutputArea jp-Cell-outputArea">
      <div class="jp-OutputArea-child">
        <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
        <div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output " data-mime-type="text/html">
          <script src="{{ url_for('static', filename='use-cases/new-business-location/new_business_location_script_1.js') }}"></script> 
        </div>
      </div>

      <div class="jp-OutputArea-child">
        <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
        <div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output " data-mime-type="text/html">
          <div>
            <div id="100b7e3b-8278-4915-a391-3a6e78c03677" class="plotly-graph-div" style="height:800px; width:950px;"></div>
            <script src="{{ url_for('static', filename='use-cases/new-business-location/new_business_location_script_2.js') }}"></script>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
  <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-InputArea jp-Cell-inputArea">
      <div class="jp-InputPrompt jp-InputArea-prompt"></div>
      <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
        <p>You've successfully used Melbourne CLUE Open Data and Plotly to visualise residential density in the City of Melbourne!<br>
        Now zoom in and out on the map above to explore the city and areas of high and low residential density.<br><br>
        This is your first step to selecting a suitable location for your new business!</p>
      </div>
    </div>
  </div>
</div>

<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
  <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-InputArea jp-Cell-inputArea">
      <div class="jp-InputPrompt jp-InputArea-prompt"></div>
      <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
        <p><strong><a href="https://github.com/Chameleon-company/MOP-Code/blob/master/datascience/dataanalysis/eda-clue-residentialdwellings.ipynb">You can explore the Residential Density data here</a></strong>.</p>
      </div>
    </div>
  </div>
</div>

<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
  <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-InputArea jp-Cell-inputArea">
      <div class="jp-InputPrompt jp-InputArea-prompt"></div>
      <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
        <div class="usecase-section-header">Visualising Residential Dwelling on a Choropleth Map</div>
      </div>
    </div>
  </div>
</div>


<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
  <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-InputArea jp-Cell-inputArea">
      <div class="jp-InputPrompt jp-InputArea-prompt"></div>
      <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
        <p>To build our view of cafe venue seating and how it relates to residential density we need to visualise both datasets on the same interactive map view.</p>
        <p>We can do this by adding a new layer (or "trace" as it is called in Plotly) to our previous map of residential density.</p>
        <p>Let's extract the Melbourne CLUE cafe, restaurant, bistro seats dataset and summarise it so its ready to plot.</p>
      </div>
    </div>
  </div>
</div>



<div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
  <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-InputArea jp-Cell-inputArea">
      <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[7]:</div>
      <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
        <div class="snippet-language">
          <span class="icon"><i class="fab fa-python"></i></span>
          <span class=>Python</span>
        </div>
        <figure class="highlight">
          <pre>
            <code class="language-python" data-lang="python"><span></span><span class="c1"># Pull dataset from Melbourne Open Data Portal</span>
<span class="n">data_dyqx_cfn5</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">get_all</span><span class="p">(</span><span class="s1">&#39;dyqx-cfn5&#39;</span><span class="p">))</span> <span class="c1"># Melbourne CLUE Cafe, restaurant, bistro seats</span>

<span class="c1"># Cast columns to correct data type</span>
<span class="n">integer_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;census_year&#39;</span><span class="p">,</span> <span class="s1">&#39;block_id&#39;</span><span class="p">,</span> <span class="s1">&#39;property_id&#39;</span><span class="p">,</span> <span class="s1">&#39;base_property_id&#39;</span><span class="p">,</span> <span class="s1">&#39;industry_anzsic4_code&#39;</span><span class="p">,</span> <span class="s1">&#39;number_of_seats&#39;</span><span class="p">]</span>
<span class="n">fp_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;x_coordinate&#39;</span><span class="p">,</span> <span class="s1">&#39;y_coordinate&#39;</span><span class="p">]</span>
<span class="n">data_dyqx_cfn5</span><span class="p">[</span><span class="n">integer_columns</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_dyqx_cfn5</span><span class="p">[</span><span class="n">integer_columns</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">data_dyqx_cfn5</span><span class="p">[</span><span class="n">fp_columns</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_dyqx_cfn5</span><span class="p">[</span><span class="n">fp_columns</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">data_dyqx_cfn5</span> <span class="o">=</span> <span class="n">data_dyqx_cfn5</span><span class="o">.</span><span class="n">convert_dtypes</span><span class="p">()</span> <span class="c1"># convert remaining to string</span>

<span class="c1"># Summarise venue seating by location</span>
<span class="n">groupbyfields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;clue_small_area&#39;</span><span class="p">,</span><span class="s1">&#39;block_id&#39;</span><span class="p">,</span><span class="s1">&#39;y_coordinate&#39;</span><span class="p">,</span><span class="s1">&#39;x_coordinate&#39;</span><span class="p">]</span>
<span class="n">aggregatebyfields</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;number_of_seats&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;sum&quot;</span><span class="p">]}</span>

<span class="n">seatsByLocn</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data_dyqx_cfn5</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">groupbyfields</span><span class="p">,</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">aggregatebyfields</span><span class="p">))</span>
<span class="n">seatsByLocn</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">seatsByLocn</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">)</span> <span class="c1"># flatten column header</span>
<span class="n">seatsByLocn</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;clue_small_area&#39;</span><span class="p">:</span> <span class="s1">&#39;clue_area&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1">#rename to match GeoJSON extract</span>
<span class="n">seatsByLocn</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;number_of_seatssum&#39;</span><span class="p">:</span> <span class="s1">&#39;number_of_seats&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1">#rename to match GeoJSON extract</span>
<span class="n">seatsByLocn</span><span class="p">[</span><span class="s1">&#39;number_of_seats&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">seatsByLocn</span><span class="p">[</span><span class="s1">&#39;number_of_seats&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="c1"># Calculate scale for drawing each bubble on scatter map plot</span>
<span class="n">all_data_diffq</span> <span class="o">=</span> <span class="p">(</span><span class="n">seatsByLocn</span><span class="p">[</span><span class="s2">&quot;number_of_seats&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">seatsByLocn</span><span class="p">[</span><span class="s2">&quot;number_of_seats&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="mi">16</span>
<span class="n">seatsByLocn</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">seatsByLocn</span><span class="p">[</span><span class="s2">&quot;number_of_seats&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">seatsByLocn</span><span class="p">[</span><span class="s2">&quot;number_of_seats&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="n">all_data_diffq</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">seatsByLocn</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">seatsByLocn</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span>
<span class="n">seatsByLocn</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
            </code>
          </pre>
        </figure>
      </div>
    </div>
  </div>

  <div class="jp-Cell-outputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-OutputArea jp-Cell-outputArea">
      <div class="jp-OutputArea-child">
        <div class="jp-OutputPrompt jp-OutputArea-prompt">Out[7]:</div>
        <div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/html">
          <div>
            <style scoped>
                .dataframe tbody tr th:only-of-type {
                    vertical-align: middle;
                }

                .dataframe tbody tr th {
                    vertical-align: top;
                }

                .dataframe thead th {
                    text-align: right;
                }
            </style>
            <table border="1" class="dataframe">
              <thead>
                <tr style="text-align: right;">
                  <th></th>
                  <th>clue_area</th>
                  <th>block_id</th>
                  <th>y_coordinate</th>
                  <th>x_coordinate</th>
                  <th>number_of_seats</th>
                  <th>scale</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <th>0</th>
                  <td>Carlton</td>
                  <td>203</td>
                  <td>-37.796707</td>
                  <td>144.965534</td>
                  <td>51</td>
                  <td>3</td>
                </tr>
                <tr>
                  <th>1</th>
                  <td>Carlton</td>
                  <td>203</td>
                  <td>-37.796680</td>
                  <td>144.964900</td>
                  <td>42</td>
                  <td>3</td>
                </tr>
                <tr>
                  <th>2</th>
                  <td>Carlton</td>
                  <td>204</td>
                  <td>-37.797833</td>
                  <td>144.965174</td>
                  <td>50</td>
                  <td>3</td>
                </tr>
                <tr>
                  <th>3</th>
                  <td>Carlton</td>
                  <td>204</td>
                  <td>-37.797255</td>
                  <td>144.965754</td>
                  <td>120</td>
                  <td>3</td>
                </tr>
                <tr>
                  <th>4</th>
                  <td>Carlton</td>
                  <td>205</td>
                  <td>-37.799470</td>
                  <td>144.964893</td>
                  <td>96</td>
                  <td>3</td>
                </tr>
                <tr>
                  <th>5</th>
                  <td>Carlton</td>
                  <td>205</td>
                  <td>-37.799001</td>
                  <td>144.964765</td>
                  <td>80</td>
                  <td>3</td>
                </tr>
                <tr>
                  <th>6</th>
                  <td>Carlton</td>
                  <td>205</td>
                  <td>-37.798721</td>
                  <td>144.965257</td>
                  <td>41</td>
                  <td>3</td>
                </tr>
                <tr>
                  <th>7</th>
                  <td>Carlton</td>
                  <td>206</td>
                  <td>-37.800457</td>
                  <td>144.966558</td>
                  <td>51</td>
                  <td>3</td>
                </tr>
                <tr>
                  <th>8</th>
                  <td>Carlton</td>
                  <td>206</td>
                  <td>-37.800191</td>
                  <td>144.966716</td>
                  <td>140</td>
                  <td>3</td>
                </tr>
                <tr>
                  <th>9</th>
                  <td>Carlton</td>
                  <td>206</td>
                  <td>-37.800046</td>
                  <td>144.966741</td>
                  <td>115</td>
                  <td>3</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
  <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-InputArea jp-Cell-inputArea">
      <div class="jp-InputPrompt jp-InputArea-prompt"></div>
      <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
        <p>Above we can see our summary dataframe has calculated the total number of seats (indoor and outdoor) at each unique locations (latitude and longitude).</p>
        <p>Since there is such a wide variance in venue seating across the city we need to scale the size of the bubbles drawn on the map to just a few (16) distinct sizes.</p>
        <p>We set the lowest scale to 3 to ensure even the smallest venue's bubble is large enough when one zooms in at block level.</p>
        <p>The next step is to display both the Choropleth and Scatter maps.
        We first draw the choropleth map showing residential density.
        We then draw the scatter plot assigning it as a trace (aka "layer") to the existing figure then show both.</p>
      </div>
    </div>
  </div>
</div>




<div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
  <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-InputArea jp-Cell-inputArea">
      <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[8]:</div>
      <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
        <div class="snippet-language">
          <span class="icon"><i class="fab fa-python"></i></span>
          <span class=>Python</span>
        </div>
        <figure class="highlight">
          <pre>
            <code class="language-python" data-lang="python"><span></span><span class="c1"># Plot residential density and venue seating</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">choropleth_mapbox</span><span class="p">(</span><span class="n">dwellingsByBlock</span><span class="p">,</span> <span class="n">geojson</span><span class="o">=</span><span class="n">block</span><span class="p">,</span> <span class="n">locations</span><span class="o">=</span><span class="s1">&#39;block_id&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;dwelling_count&#39;</span><span class="p">,</span>
                           <span class="n">color_continuous_scale</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;#FFFF88&quot;</span><span class="p">,</span> <span class="s2">&quot;yellow&quot;</span><span class="p">,</span> <span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="s2">&quot;orange&quot;</span><span class="p">,</span>
                                                   <span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="s2">&quot;darkorange&quot;</span><span class="p">,</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;darkred&quot;</span><span class="p">],</span>
                           <span class="n">range_color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dwellingsByBlock</span><span class="p">[</span><span class="s1">&#39;dwelling_count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()),</span>
                           <span class="n">featureidkey</span><span class="o">=</span><span class="s2">&quot;properties.block_id&quot;</span><span class="p">,</span>
                           <span class="n">mapbox_style</span><span class="o">=</span><span class="s2">&quot;stamen-toner&quot;</span><span class="p">,</span> <span class="c1">#&quot;carto-positron&quot;,</span>
                           <span class="n">zoom</span><span class="o">=</span><span class="mf">12.15</span><span class="p">,</span>
                           <span class="n">center</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;lat&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">37.813</span><span class="p">,</span> <span class="s2">&quot;lon&quot;</span><span class="p">:</span> <span class="mf">144.945</span><span class="p">},</span>
                           <span class="n">opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                           <span class="n">hover_name</span><span class="o">=</span><span class="s1">&#39;clue_area&#39;</span><span class="p">,</span>
                           <span class="n">hover_data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;block_id&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;dwelling_count&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">},</span>
                           <span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;dwelling_count&#39;</span><span class="p">:</span><span class="s1">&#39;Number of Dwellings&#39;</span><span class="p">,</span><span class="s1">&#39;block_id&#39;</span><span class="p">:</span><span class="s1">&#39;CLUE Block Id&#39;</span><span class="p">},</span>
                           <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Residential Dwellings Density &amp; Venue Seating (2020)&#39;</span><span class="p">,</span>
                           <span class="n">width</span><span class="o">=</span><span class="mi">950</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">800</span>
                          <span class="p">)</span>

<span class="c1"># Plot of venue seating</span>
<span class="n">fig2</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter_mapbox</span><span class="p">(</span><span class="n">seatsByLocn</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="s2">&quot;y_coordinate&quot;</span><span class="p">,</span> <span class="n">lon</span><span class="o">=</span><span class="s2">&quot;x_coordinate&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;scale&quot;</span><span class="p">,</span>
                        <span class="n">mapbox_style</span><span class="o">=</span><span class="s2">&quot;stamen-toner&quot;</span><span class="p">,</span>
                        <span class="n">zoom</span><span class="o">=</span><span class="mf">12.15</span><span class="p">,</span>
                        <span class="n">center</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;lat&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">37.813</span><span class="p">,</span> <span class="s2">&quot;lon&quot;</span><span class="p">:</span> <span class="mf">144.945</span><span class="p">},</span>
                        <span class="n">opacity</span><span class="o">=</span><span class="mf">0.70</span><span class="p">,</span>
                        <span class="n">hover_name</span><span class="o">=</span><span class="s2">&quot;clue_area&quot;</span><span class="p">,</span>
                        <span class="n">hover_data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;block_id&quot;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s2">&quot;scale&quot;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span><span class="s2">&quot;number_of_seats&quot;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s2">&quot;x_coordinate&quot;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span><span class="s2">&quot;y_coordinate&quot;</span><span class="p">:</span><span class="kc">False</span><span class="p">},</span>
                        <span class="n">color_discrete_sequence</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;purple&#39;</span><span class="p">],</span>
                        <span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;number_of_seats&#39;</span><span class="p">:</span><span class="s1">&#39;Number of Seats&#39;</span><span class="p">,</span> <span class="s1">&#39;block_id&#39;</span><span class="p">:</span><span class="s1">&#39;CLUE Block Id&#39;</span><span class="p">},</span>
                        <span class="n">width</span><span class="o">=</span><span class="mi">950</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">800</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">fig2</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_geos</span><span class="p">(</span><span class="n">fitbounds</span><span class="o">=</span><span class="s2">&quot;locations&quot;</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            </code>
          </pre>
        </figure>
      </div>
    </div>
  </div>
  <div class="jp-Cell-outputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-OutputArea jp-Cell-outputArea">
      <div class="jp-OutputArea-child">
        <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>



        <div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output " data-mime-type="text/html">
          <div>
            <div id="d7e9af0d-a583-496d-8b60-25129d685db4" class="plotly-graph-div" style="height:800px; width:950px;"></div>         
            <script src="{{ url_for('static', filename='use-cases/new-business-location/new_business_location_script_3.js') }}"></script>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>


<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
  <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-InputArea jp-Cell-inputArea">
      <div class="jp-InputPrompt jp-InputArea-prompt"></div>
      <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
        <p>You've successfully used Melbourne CLUE Open Data and Plotly to visualise residential density and venue seating in the City of Melbourne in one map!<br>
        Now zoom in and out on the map above to explore the city and areas of high residential density but low venue seating.<br><br>
        This could be a possible location for your new business!</p>
      </div>
    </div>
  </div>
</div>


<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
  <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-InputArea jp-Cell-inputArea">
      <div class="jp-InputPrompt jp-InputArea-prompt"></div>
      <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
        <p><strong><a href="https://github.com/D2I-Melbourne/MOP-Code/blob/08a67e561eccf10b996ba68289bb7ed8745aa2dd/datascience/dataanalysis/eda-clue-venueseats.ipynb"target="_blank">You can explore the Venue Seating data in more detail here</a></strong>.</p>
      </div>
    </div>
  </div>
</div>


<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
  <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-InputArea jp-Cell-inputArea">
      <div class="jp-InputPrompt jp-InputArea-prompt"></div>
      <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
        <div class="usecase-section-header">Building an Interactive Visualisation for New Business Location</div>
      </div>
    </div>
  </div>
</div>

<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
  <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-InputArea jp-Cell-inputArea">
      <div class="jp-InputPrompt jp-InputArea-prompt"></div>
      <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
        <p>In the previous step we saw how we can create a new layer, also called a trace, to an existing mapbox plot in order to visualise both residential density and cafe or Restaurant venue seating on the one map.</p>
        <p>We now wish to add Employment Density to this visualisation.
        Since Employment density and Residential density both require use a choropleth map to visualise data at CLUE block level, we canot overlay these two layers at the same time.</p>
        <p>We therefore need a way to select the base choropleth map to show either residential density or employment density and then optionally turn on or off the venue seating as an additional scatter map box layer.</p>
        <p>To achieve this interactivity we can make use of Plotly express functions to build a drop down menu and button to be overlaid on the map.</p>
        <p>We will require three datasets and associated layers (traces) for this visualation.</p>
        <p>Let's start by extracting our third dataset titled <strong><a href="https://data.melbourne.vic.gov.au/Business/Employment-per-industry-for-blocks-2020/qnju-it8g"target="_blank">"Employment per industry for blocks 2020"</a></strong> and performing some data preparation prior to plotting.</p>
        <p><em>Note: The **</em>"Employment per industry for blocks 2020"<em>** dataset is a summary of employment at CLUE Block level and so we do not need to perform a groupby aggregation on the dataset.</em></p>
      </div>
    </div>
  </div>
</div>




<div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
  <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-InputArea jp-Cell-inputArea">
      <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[9]:</div>
      <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
        <div class="snippet-language">
          <span class="icon"><i class="fab fa-python"></i></span>
          <span class=>Python</span>
        </div>
        <figure class="highlight">
          <pre>
            <code class="language-python" data-lang="python"><span></span><span class="c1"># Pull dataset from Melbourne Open Data Portal</span>
<span class="n">data_qnju_it8g</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">get_all</span><span class="p">(</span><span class="s1">&#39;qnju-it8g&#39;</span><span class="p">))</span> <span class="c1"># Employment per industry for blocks 2020</span>

<span class="c1"># Filter out unwanted columns</span>
<span class="n">columnsToKeep</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;clue_small_area&#39;</span><span class="p">,</span><span class="s1">&#39;block_id&#39;</span><span class="p">,</span><span class="s1">&#39;total_employment_in_block&#39;</span><span class="p">]</span>
<span class="n">employmentByBlock</span> <span class="o">=</span> <span class="n">data_qnju_it8g</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">columnsToKeep</span><span class="p">)</span>

<span class="c1"># Rename to match GeoJSON extract</span>
<span class="n">employmentByBlock</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;clue_small_area&#39;</span><span class="p">:</span> <span class="s1">&#39;clue_area&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Replace all NaNs with zero</span>
<span class="n">employmentByBlock</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Cast columns to correct datatype</span>
<span class="n">employmentByBlock</span><span class="p">[[</span><span class="s1">&#39;block_id&#39;</span><span class="p">,</span><span class="s1">&#39;total_employment_in_block&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">employmentByBlock</span><span class="p">[[</span><span class="s1">&#39;block_id&#39;</span><span class="p">,</span><span class="s1">&#39;total_employment_in_block&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">employmentByBlock</span> <span class="o">=</span> <span class="n">employmentByBlock</span><span class="o">.</span><span class="n">convert_dtypes</span><span class="p">()</span> <span class="c1"># convert remaining to string</span>

<span class="c1"># Exclude summary total for all of City of Melbourne</span>
<span class="n">employmentByBlock</span> <span class="o">=</span> <span class="n">employmentByBlock</span><span class="p">[</span><span class="n">employmentByBlock</span><span class="p">[</span><span class="s1">&#39;block_id&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> 

<span class="c1"># Display sample data</span>
<span class="n">employmentByBlock</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
            </code>
          </pre>
        </figure>
      </div>
    </div>
  </div>

  <div class="jp-Cell-outputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-OutputArea jp-Cell-outputArea">
      <div class="jp-OutputArea-child">
        <div class="jp-OutputPrompt jp-OutputArea-prompt">Out[9]:</div>
        <div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/html">
          <div>
            <style scoped>
                .dataframe tbody tr th:only-of-type {
                    vertical-align: middle;
                }

                .dataframe tbody tr th {
                    vertical-align: top;
                }

                .dataframe thead th {
                    text-align: right;
                }
            </style>
            <table border="1" class="dataframe">
              <thead>
                <tr style="text-align: right;">
                  <th></th>
                  <th>clue_area</th>
                  <th>block_id</th>
                  <th>total_employment_in_block</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <th>0</th>
                  <td>Melbourne (CBD)</td>
                  <td>1</td>
                  <td>764</td>
                </tr>
                <tr>
                  <th>1</th>
                  <td>Melbourne (CBD)</td>
                  <td>2</td>
                  <td>195</td>
                </tr>
                <tr>
                  <th>2</th>
                  <td>Melbourne (CBD)</td>
                  <td>4</td>
                  <td>653</td>
                </tr>
                <tr>
                  <th>3</th>
                  <td>Melbourne (CBD)</td>
                  <td>5</td>
                  <td>5</td>
                </tr>
                <tr>
                  <th>4</th>
                  <td>Melbourne (CBD)</td>
                  <td>6</td>
                  <td>843</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>



<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
  <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-InputArea jp-Cell-inputArea">
      <div class="jp-InputPrompt jp-InputArea-prompt"></div>
      <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
        <p>Now we have a dataset showing total number of employmees by CLUE block, let's visualise it as a choropleth map and overlay venue seating.</p>
        <p>In this map visualisation we will use a different map style called "open-street-map" which lets us identify the names of venues close to where the venue seating measures have been reported. <strong>Note that not all venues may have been marked on Open Street Maps.</strong></p>
        <p>Mapbox styles which do not require a Mapbox API token are 'open-street-map', 'white-bg', 'carto-positron', 'carto-darkmatter', 'stamen- terrain', 'stamen-toner', 'stamen-watercolor'. Mapbox styles which do require a Mapbox API token are 'basic', 'streets', 'outdoors', 'light', 'dark', 'satellite', 'satellite- streets'.</p>
        <p><strong>Source:</strong> <strong><a href="https://plotly.com/python-api-reference/generated/plotly.express.line_mapbox.html"target="_blank">plotly.express.line_mapbox documentation</a></strong></p>
      </div>
    </div>
  </div>
</div>




<div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
  <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-InputArea jp-Cell-inputArea">
      <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[10]:</div>
      <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
        <div class="snippet-language">
          <span class="icon"><i class="fab fa-python"></i></span>
          <span class=>Python</span>
        </div>
        <figure class="highlight">
          <pre>
            <code class="language-python" data-lang="python"><span></span><span class="c1"># Plot employment density</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">choropleth_mapbox</span><span class="p">(</span><span class="n">employmentByBlock</span><span class="p">,</span> <span class="n">geojson</span><span class="o">=</span><span class="n">block</span><span class="p">,</span> <span class="n">locations</span><span class="o">=</span><span class="s1">&#39;block_id&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;total_employment_in_block&#39;</span><span class="p">,</span>
                           <span class="n">color_continuous_scale</span><span class="o">=</span><span class="s2">&quot;Blues&quot;</span><span class="p">,</span>
                           <span class="n">range_color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">employmentByBlock</span><span class="p">[</span><span class="s1">&#39;total_employment_in_block&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()),</span>
                           <span class="n">featureidkey</span><span class="o">=</span><span class="s2">&quot;properties.block_id&quot;</span><span class="p">,</span>
                           <span class="n">mapbox_style</span><span class="o">=</span><span class="s2">&quot;open-street-map&quot;</span><span class="p">,</span>
                           <span class="n">zoom</span><span class="o">=</span><span class="mf">12.15</span><span class="p">,</span>
                           <span class="n">center</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;lat&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">37.813</span><span class="p">,</span> <span class="s2">&quot;lon&quot;</span><span class="p">:</span> <span class="mf">144.945</span><span class="p">},</span>
                           <span class="n">opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                           <span class="n">hover_name</span><span class="o">=</span><span class="s1">&#39;clue_area&#39;</span><span class="p">,</span>
                           <span class="n">hover_data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;block_id&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;total_employment_in_block&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">},</span>
                           <span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;total_employment_in_block&#39;</span><span class="p">:</span><span class="s1">&#39;Number of Employees&#39;</span><span class="p">,</span><span class="s1">&#39;block_id&#39;</span><span class="p">:</span><span class="s1">&#39;CLUE Block Id&#39;</span><span class="p">},</span>
                           <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Employment Density &amp; Venue Seating (2020)&#39;</span><span class="p">,</span>
                           <span class="n">width</span><span class="o">=</span><span class="mi">950</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">800</span>
                          <span class="p">)</span>

<span class="c1"># Plot of venue seating</span>
<span class="n">fig2</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter_mapbox</span><span class="p">(</span><span class="n">seatsByLocn</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="s2">&quot;y_coordinate&quot;</span><span class="p">,</span> <span class="n">lon</span><span class="o">=</span><span class="s2">&quot;x_coordinate&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;scale&quot;</span><span class="p">,</span>
                        <span class="n">mapbox_style</span><span class="o">=</span><span class="s2">&quot;stamen-toner&quot;</span><span class="p">,</span>
                        <span class="n">zoom</span><span class="o">=</span><span class="mf">12.15</span><span class="p">,</span>
                        <span class="n">center</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;lat&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">37.813</span><span class="p">,</span> <span class="s2">&quot;lon&quot;</span><span class="p">:</span> <span class="mf">144.945</span><span class="p">},</span>
                        <span class="n">opacity</span><span class="o">=</span><span class="mf">0.70</span><span class="p">,</span>
                        <span class="n">hover_name</span><span class="o">=</span><span class="s2">&quot;clue_area&quot;</span><span class="p">,</span>
                        <span class="n">hover_data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;block_id&quot;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s2">&quot;scale&quot;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span><span class="s2">&quot;number_of_seats&quot;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s2">&quot;x_coordinate&quot;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span><span class="s2">&quot;y_coordinate&quot;</span><span class="p">:</span><span class="kc">False</span><span class="p">},</span>
                        <span class="n">color_discrete_sequence</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;purple&#39;</span><span class="p">],</span>
                        <span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;number_of_seats&#39;</span><span class="p">:</span><span class="s1">&#39;Number of Seats&#39;</span><span class="p">,</span> <span class="s1">&#39;block_id&#39;</span><span class="p">:</span><span class="s1">&#39;CLUE Block Id&#39;</span><span class="p">},</span>
                        <span class="n">width</span><span class="o">=</span><span class="mi">950</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">800</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">fig2</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_geos</span><span class="p">(</span><span class="n">fitbounds</span><span class="o">=</span><span class="s2">&quot;locations&quot;</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            </code>
          </pre>
        </figure>
      </div>
    </div>
  </div>

  <div class="jp-Cell-outputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-OutputArea jp-Cell-outputArea">
      <div class="jp-OutputArea-child">
        <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
        <div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output " data-mime-type="text/html">
        <div>
        <div id="4c67221b-823b-4961-a39c-7240b647bfc5" class="plotly-graph-div" style="height:800px; width:950px;"></div>
        <script src="{{ url_for('static', filename='use-cases/new-business-location/new_business_location_script_4.js') }}"target="_blank"></script>        </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
  <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-InputArea jp-Cell-inputArea">
      <div class="jp-InputPrompt jp-InputArea-prompt"></div>
      <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
        <div class="usecase-section-header">Combining all map layers into one interactive map box visualisation</div>
      </div>
    </div>
  </div>
</div>


<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
  <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-InputArea jp-Cell-inputArea">
      <div class="jp-InputPrompt jp-InputArea-prompt"></div>
      <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
      <p>Let's now build a single map box visualisation using our three datasets.</p>
      <p>Our first step is to create a base plotly figure to which we can add each individual map plot as a new layer.</p>
      <p>The title of the visualisation and any common parameters can be set using the fig.update_layout() method.</p>
      <p>In the cell below we also have defined two custom colorscales, one continuous for the choropleth map and the other discrete for the scatter map plot.</p>
      <p>We then create a figure for each dataset and add it as a layer to the base figure using the fig.add_trace() method.</p>
      </div>
    </div>
  </div>
</div>




<div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
  <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-InputArea jp-Cell-inputArea">
      <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[11]:</div>
      <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
        <div class="snippet-language">
          <span class="icon"><i class="fab fa-python"></i></span>
          <span class=>Python</span>
        </div>
        <figure class="highlight">
          <pre>
            <code class="language-python" data-lang="python"><span></span><span class="c1"># Define custom colour scale for choropleth (continuous) and scatter (discrete)</span>
<span class="n">custom_continuous_colorscale</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;lightblue&quot;</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;darkblue&quot;</span><span class="p">)]</span>
<span class="n">custom_discrete_colorscale</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">]</span>

<span class="c1"># Create the base figure to which layers(traces) will be added.</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>

<span class="c1"># Set the default style for the map</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">mapbox_style</span><span class="o">=</span><span class="s2">&quot;open-street-map&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">hovermode</span><span class="o">=</span><span class="s1">&#39;closest&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">mapbox_center_lat</span><span class="o">=-</span><span class="mf">37.813</span><span class="p">,</span> <span class="n">mapbox_center_lon</span><span class="o">=</span><span class="mf">144.945</span><span class="p">,</span> <span class="n">mapbox_zoom</span><span class="o">=</span><span class="mf">12.15</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">950</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">800</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Residential &amp; Employment Density plus Venue Seating (2020)&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">coloraxis_colorscale</span><span class="o">=</span><span class="n">custom_continuous_colorscale</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">coloraxis_colorbar</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span><span class="s1">&#39;Density&#39;</span><span class="p">})</span>

<span class="c1"># Create the definition for the Residential Dwellings Layer</span>
<span class="n">fig1</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">choropleth_mapbox</span><span class="p">(</span><span class="n">dwellingsByBlock</span><span class="p">,</span> <span class="n">geojson</span><span class="o">=</span><span class="n">block</span><span class="p">,</span> <span class="n">locations</span><span class="o">=</span><span class="s1">&#39;block_id&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;dwelling_count&#39;</span><span class="p">,</span>
                           <span class="n">range_color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dwellingsByBlock</span><span class="p">[</span><span class="s1">&#39;dwelling_count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()),</span>
                           <span class="n">featureidkey</span><span class="o">=</span><span class="s2">&quot;properties.block_id&quot;</span><span class="p">,</span>
                           <span class="n">hover_name</span><span class="o">=</span><span class="s1">&#39;clue_area&#39;</span><span class="p">,</span>
                           <span class="n">hover_data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;block_id&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;dwelling_count&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">},</span>
                           <span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;dwelling_count&#39;</span><span class="p">:</span><span class="s1">&#39;Number of Dwellings&#39;</span><span class="p">,</span><span class="s1">&#39;block_id&#39;</span><span class="p">:</span><span class="s1">&#39;CLUE Block Id&#39;</span><span class="p">},</span>
                           <span class="n">opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                           
                          <span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">fig1</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># add this layer to the base figure</span>

<span class="c1"># Create the definition for the Employment Layer</span>
<span class="n">fig2</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">choropleth_mapbox</span><span class="p">(</span><span class="n">employmentByBlock</span><span class="p">,</span> <span class="n">geojson</span><span class="o">=</span><span class="n">block</span><span class="p">,</span> <span class="n">locations</span><span class="o">=</span><span class="s1">&#39;block_id&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;total_employment_in_block&#39;</span><span class="p">,</span>
                           <span class="n">range_color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">employmentByBlock</span><span class="p">[</span><span class="s1">&#39;total_employment_in_block&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()),</span>
                           <span class="n">featureidkey</span><span class="o">=</span><span class="s2">&quot;properties.block_id&quot;</span><span class="p">,</span>
                           <span class="n">hover_name</span><span class="o">=</span><span class="s1">&#39;clue_area&#39;</span><span class="p">,</span>
                           <span class="n">hover_data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;block_id&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;total_employment_in_block&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">},</span>
                           <span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;total_employment_in_block&#39;</span><span class="p">:</span><span class="s1">&#39;Number of Employees&#39;</span><span class="p">,</span><span class="s1">&#39;block_id&#39;</span><span class="p">:</span><span class="s1">&#39;CLUE Block Id&#39;</span><span class="p">},</span>
                           <span class="n">opacity</span><span class="o">=</span><span class="mf">0.5</span>
                          <span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">fig2</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># add this layer to the base figure</span>

<span class="c1"># Create the definition for the Venue Seating Layer</span>
<span class="n">fig3</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter_mapbox</span><span class="p">(</span><span class="n">seatsByLocn</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="s2">&quot;y_coordinate&quot;</span><span class="p">,</span> <span class="n">lon</span><span class="o">=</span><span class="s2">&quot;x_coordinate&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;scale&quot;</span><span class="p">,</span>
                        <span class="n">hover_name</span><span class="o">=</span><span class="s2">&quot;clue_area&quot;</span><span class="p">,</span>
                        <span class="n">hover_data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;block_id&quot;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s2">&quot;scale&quot;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span><span class="s2">&quot;number_of_seats&quot;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s2">&quot;x_coordinate&quot;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span><span class="s2">&quot;y_coordinate&quot;</span><span class="p">:</span><span class="kc">False</span><span class="p">},</span>
                        <span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;number_of_seats&#39;</span><span class="p">:</span><span class="s1">&#39;Number of Seats&#39;</span><span class="p">,</span> <span class="s1">&#39;block_id&#39;</span><span class="p">:</span><span class="s1">&#39;CLUE Block Id&#39;</span><span class="p">},</span>
                        <span class="n">opacity</span><span class="o">=</span><span class="mf">0.70</span><span class="p">,</span> <span class="n">color_discrete_sequence</span><span class="o">=</span><span class="n">custom_discrete_colorscale</span>
                        <span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">fig3</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># add this layer to the base figure</span>
            </code>
          </pre>
        </figure>
      </div>
    </div>
  </div>

  <div class="jp-Cell-outputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-OutputArea jp-Cell-outputArea">
      <div class="jp-OutputArea-child">  
        <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
        <div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output " data-mime-type="text/html">
          <div>
            <div id="5b6aa265-a3ff-42ed-a1ce-4c81797bac5a" class="plotly-graph-div" style="height:800px; width:950px;"></div>
            <script src="{{ url_for('static', filename='use-cases/new-business-location/new_business_location_script_5.js') }}"target="_blank"></script>        
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
  <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-InputArea jp-Cell-inputArea">
      <div class="jp-InputPrompt jp-InputArea-prompt"></div>
      <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
        <p>Finally, we define buttons and text to appear along the top of the map.</p>
        <p>Each button turns on a combination of layers when it is clicked. The layers it turns on are defined in the 'visible' arg array with the order of boolean values corresponding to the map layers in the order they were added.</p>
        <p>For example: When the 'Residential Density &amp; Seating' button is clicked it turns on the 1st and 3rd layer as defined by the following argument 'visible':[True, False, True] . The 1st layer was the Residential Dwelling density choropleth map and the 3rd layer was the Venue Seating Scatter map.</p>
      </div>
    </div>
  </div>
</div>


<div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
  <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-InputArea jp-Cell-inputArea">
      <div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[12]:</div>
      <div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
        <div class="snippet-language">
          <span class="icon"><i class="fab fa-python"></i></span>
          <span class=>Python</span>
        </div>
        <figure class="highlight">
          <pre>
            <code class="language-python" data-lang="python"><span></span><span class="c1"># Turn off all choropleth layers</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_traces</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">selector</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;choroplethmapbox&#39;</span><span class="p">))</span>

<span class="c1"># Add buttons for selection on plot</span>
<span class="n">buttons</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;update&#39;</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Venue Seating only&#39;</span><span class="p">,</span>  <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">args</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Venue Seating&#39;</span><span class="p">,</span> <span class="s1">&#39;visible&#39;</span><span class="p">:[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">]}]),</span>
           <span class="nb">dict</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;update&#39;</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Residential Density &amp; Seating&#39;</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">args</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Residential Dwelling Density&#39;</span><span class="p">,</span><span class="s1">&#39;visible&#39;</span><span class="p">:[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">]}]),</span>
           <span class="nb">dict</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;update&#39;</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Employment Density &amp; Seating&#39;</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">args</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Employment Density&#39;</span><span class="p">,</span><span class="s1">&#39;visible&#39;</span><span class="p">:[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">]}])</span>
          <span class="p">]</span>
                   
<span class="n">um_buttons</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;active&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;showactive&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;buttons&#39;</span><span class="p">:</span><span class="n">buttons</span><span class="p">,</span>
               <span class="s1">&#39;direction&#39;</span><span class="p">:</span> <span class="s1">&#39;down&#39;</span><span class="p">,</span> <span class="s1">&#39;xanchor&#39;</span><span class="p">:</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="s1">&#39;yanchor&#39;</span><span class="p">:</span> <span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mf">0.71</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mf">1.01</span><span class="p">}]</span>
<span class="n">map_annotations</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;text&#39;</span><span class="p">:</span><span class="s1">&#39;Please select a map view to display&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mf">1.1</span><span class="p">,</span>
                    <span class="s1">&#39;showarrow&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;font&#39;</span><span class="p">:{</span><span class="s1">&#39;family&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span><span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">14</span><span class="p">}}]</span>

<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">updatemenus</span><span class="o">=</span><span class="n">um_buttons</span><span class="p">,</span> <span class="n">annotations</span><span class="o">=</span><span class="n">map_annotations</span><span class="p">)</span>

<span class="c1"># Display the map</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            </code>
          </pre>
        </figure>
      </div>
    </div>
  </div>

  <div class="jp-Cell-outputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-OutputArea jp-Cell-outputArea">
      <div class="jp-OutputArea-child">
        <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
        <div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output " data-mime-type="text/html">
          <div>
            <div id="42e02259-9050-45bf-9704-f9acf66839cb" class="plotly-graph-div" style="height:800px; width:950px;"></div>
            <script src="{{ url_for('static', filename='use-cases/new-business-location/new_business_location_script_6.js') }}"target="_blank"></script>        
          </div>
        </div>
      </div>
  </div>
  </div>
</div>

<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
  <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-InputArea jp-Cell-inputArea">
      <div class="jp-InputPrompt jp-InputArea-prompt"></div>
      <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
        <div class="usecase-section-header">Congratulations. Our interactive map is now complete!</div>
      </div>
    </div>
  </div>
</div>


<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
  <div class="jp-Cell-inputWrapper">
    <div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"></div>
    <div class="jp-InputArea jp-Cell-inputArea">
      <div class="jp-InputPrompt jp-InputArea-prompt"></div>
      <div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
        <p>Now you can use the controls on the map above to explore the City of Melbourne and observe the residential density and employment density of each city block in relation to venue seating capacity.<br><br></p>
        <p>If you would like to extend this interactive map further, please visit the <strong><a href="https://data.melbourne.vic.gov.au/"target="_blank">City of Melbourne Open Data Site</a></strong> and explore some of the other valuable datasets including:</p>
        <ul>
        <li><strong><a href="https://data.melbourne.vic.gov.au/Transport/Off-street-car-parking-2020/g9am-cna5"target="_blank">Off Street Parking</a></strong></li>
        <li><strong><a href="https://data.melbourne.vic.gov.au/Transport/Pedestrian-Counting-System-Monthly-counts-per-hour/b2ak-trbp"target="_blank">Pedestrian Counting System</a></strong></li>
        <li><strong><a href="https://data.melbourne.vic.gov.au/Environment/Microclimate-Sensor-Readings/u4vh-84j8?src=featured_banner"target="_blank">Microclimate sensor readings</a></strong></li>
        </ul>
      </div>
    </div>
  </div>
</div>

</div>

<script>
        hljs.highlightAll();
</script>

{% endblock %}